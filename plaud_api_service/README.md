# Сервис для работы с Plaud API

Сервис для работы с Plaud API: получение списка директорий и записей, экспорт папок в формат Markdown.

## Установка

1. Создайте виртуальное окружение:
```bash
python3 -m venv venv
source venv/bin/activate
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.token` в этой директории и поместите туда bearer токен (без префикса `Bearer`):
```bash
echo "your_token_here" > .token
```

## Использование

### Получить список всех директорий/тегов

```bash
python client.py --list-tags
```

Это вернет список всех директорий с их ID, которые можно использовать для фильтрации записей.

### Получить записи из конкретной директории

**Для директории "nubes":**
```bash
python client.py --list-files --tag-id 2aa8d467fac50b36b3df523c65a177d5 --category-id nubes --limit 100
```

**Для директории "highload":**
```bash
python client.py --list-files --tag-id bff3ba067feed713e5806de648d6b62e --category-id "highload 2026" --limit 100
```

### Получить все записи (включая корзину)

```bash
python client.py --list-files --include-trash --limit 99999
```

### Получить последние записи

```bash
python client.py --list-files --sort-by edit_time --limit 10
```

### Экспорт папки в Markdown

Экспортирует все файлы из указанной папки в формат Markdown. Файлы сохраняются в директории `exports/` с сохранением структуры папок Plaud.

**Экспорт папки "test":**
```bash
# С указанием tag-id и category-id
python client.py --export-folder test --tag-id dfe0196faff995fea778f902503ef313 --category-id test

# Или просто по названию (скрипт сам найдет tag-id)
python client.py --export-folder test
```

**Экспорт папки "nubes":**
```bash
python client.py --export-folder nubes --tag-id 2aa8d467fac50b36b3df523c65a177d5 --category-id nubes
```

**Экспорт всех папок:**
```bash
# Экспортировать все папки
python client.py --export-all

# С указанием директории для экспорта
python client.py --export-all --export-dir my_exports
```

**Параметры экспорта:**
- `--export-folder <название>` - название папки для экспорта (обязательно при экспорте одной папки)
- `--export-all` - экспортировать все папки (взаимоисключающий с `--export-folder`)
- `--tag-id <id>` - ID тега/директории (опционально, можно найти через `--list-tags`)
- `--category-id <название>` - название категории (опционально)
- `--export-dir <путь>` - директория для экспорта (по умолчанию: `exports`)

**Результат экспорта:**
- Файлы сохраняются в `exports/<название_папки>/`
- Каждый файл экспортируется как `<имя_файла>.md`
- Для файлов с транскрипцией экспортируется полное содержимое
- Для файлов без транскрипции создается базовый markdown с метаданными (название, длительность, дата)
- При экспорте всех папок (`--export-all`) каждая папка экспортируется в отдельную директорию

## API Endpoints

### 1. Получение списка директорий/тегов

**Endpoint:** `GET https://api.plaud.ai/filetag/`

Возвращает список всех директорий с их ID и названиями.

### 2. Получение списка записей

**Endpoint:** `GET https://api.plaud.ai/file/simple/web`

**Параметры:**
- `skip=0` - количество записей для пропуска
- `limit=50` - максимальное количество записей
- `is_trash=0` - не включать корзину (0) или включать (2)
- `sort_by=start_time` - поле сортировки (`start_time` или `edit_time`)
- `is_desc=true` - сортировка по убыванию (true) или возрастанию (false)
- `tagId=<id>` - опционально: фильтр по ID тега/директории
- `categoryId=<name>` - опционально: фильтр по названию категории

## Найденные директории в логах

### Директория "nubes"
- **tagId:** `2aa8d467fac50b36b3df523c65a177d5`
- **categoryId:** `nubes`

### Директория "highload"
- **tagId:** `bff3ba067feed713e5806de648d6b62e`
- **categoryId:** `highload 2026`

## Важные замечания

1. **Авторизация:** Все запросы требуют заголовок `Authorization: bearer <TOKEN>`
2. **tagId vs categoryId:** 
   - `tagId` - уникальный идентификатор тега/директории
   - `categoryId` - название категории (может быть "nubes", "highload 2026", "allFiles" и т.д.)
3. **Получение ID директорий:** Сначала вызовите `--list-tags` чтобы получить список всех директорий с их ID
4. **Фильтрация:** Можно использовать только `tagId`, только `categoryId`, или оба параметра вместе
5. **Экспорт папок:** 
   - Экспортируются только файлы, которые действительно принадлежат указанной папке (проверяется через `filetag_id_list`)
   - Структура папок в Plaud сохраняется в директории экспорта
   - Если папка для экспорта не существует, она будет создана автоматически
   - Файлы экспортируются в формате Markdown с сохранением транскрипции или метаданных

